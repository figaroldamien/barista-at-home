---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("posts");
const sortedPosts = posts.sort(
    (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
);
const latestPosts = sortedPosts.slice(0, 3);
---

<Layout title="Accueil">
    <section class="hero">
        <h2>Bienvenue sur mon blog de Latte Art</h2>
        <p>
            Barista passionné, je partage avec vous mes techniques et astuces
            pour réaliser de beaux latte art chez vous, avec votre propre
            machine. Que vous soyez débutant ou amateur éclairé, vous trouverez
            ici des guides pratiques pour progresser à votre rythme.
        </p>
    </section>

    <section class="posts-grid">
        <h3>Derniers articles</h3>
        <div class="posts-list">
            {
                latestPosts.map((post) => (
                    <article class="post-card">
                        {post.data.coverImage && (
                            <img
                                src={post.data.coverImage}
                                alt={post.data.coverImageAlt || post.data.title}
                                class="post-card-image"
                            />
                        )}
                        <div class="post-card-content">
                            <h4>
                                <a href={`/posts/${post.slug}`}>
                                    {post.data.title}
                                </a>
                            </h4>
                            <div class="post-card-meta">
                                <time datetime={post.data.date}>
                                    {new Date(
                                        post.data.date,
                                    ).toLocaleDateString("fr-FR", {
                                        year: "numeric",
                                        month: "long",
                                        day: "numeric",
                                    })}
                                </time>
                                {post.data.difficulty && (
                                    <span> • {post.data.difficulty}</span>
                                )}
                            </div>
                            <p>{post.data.description}</p>
                        </div>
                    </article>
                ))
            }
        </div>
    </section>
</Layout>
